from flask import Flask, jsonify, render_template, request
from flask_jwt_extended import JWTManager, create_access_token, jwt_required, get_jwt_identity
from pymongo import MongoClient
from flask_bcrypt import Bcrypt

app = Flask(__name__)

client = MongoClient('localhost', 27017) 
db = client.jungle5thMembers
bcrypt = Bcrypt(app)
jwt = JWTManager(app)

@app.route('/')
def home():
    return render_template('index.html')

# 회원가입
@app.route('/users/register', methods=['POST']) 
def register() : 
    id_receive = request.form['id_give']
    pw_receive = request.form['pw_give']
    pw_hash = bcrypt.generate_password_hash(pw_receive).decode('utf-8')

    if db.users.count_documents({'id': id_receive}) == 0:
        db.users.insert_one({'id': id_receive, 'password': pw_hash})
        return jsonify({'result': 'success', 'message': 'register success'})
    else:
        return jsonify({'result': 'failure', 'message': 'id already exists'})

# ID 중복 확인
@app.route('/users/check_id', methods=['GET']) 
def check_id() : 
    id_receive = request.args.get('id_give')

    if db.users.count_documents({'id': id_receive}) == 0:
        return jsonify({'result': 'success', 'message': 'usable id'})
    else:
        return jsonify({'result': 'failure', 'message': 'id already exists'})

if __name__ == '__main__':
    app.run('127.0.0.1', port=5001, debug=True)
